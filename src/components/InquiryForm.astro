---
import { ACTIVITIES } from '../utils/siteData';
---

<div class="w-full max-w-2xl mx-auto" id="inquiry-form">
  <form
    action="https://api.web3forms.com/submit"
    method="POST"
    id="multi-step-form"
    class="card p-6 md:p-8"
  >
    <input type="hidden" name="access_key" value="YOUR_WEB3FORMS_KEY" />
    <input type="hidden" name="subject" value="New Inquiry from Chill Bali Trips" />
    <input type="hidden" name="from_name" value="Chill Bali Trips Website" />
    <input type="checkbox" name="botcheck" class="hidden" />

    <!-- Progress Bar -->
    <div class="flex items-center justify-between mb-8">
      {[1, 2, 3].map(step => (
        <div class="flex items-center flex-1">
          <div
            class:list={[
              'w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300 step-indicator',
              step === 1 ? 'bg-gold-500 text-ocean-950' : 'bg-white/10 text-gray-400',
            ]}
            data-step={step}
          >
            {step}
          </div>
          {step < 3 && (
            <div class="flex-1 h-0.5 mx-2 bg-white/10 rounded-full overflow-hidden">
              <div class="h-full bg-gold-500 transition-all duration-500 step-progress" data-step={step} style="width: 0%"></div>
            </div>
          )}
        </div>
      ))}
    </div>

    <!-- Step 1: Contact Info -->
    <div class="form-step" data-step="1">
      <h3 class="text-xl font-bold text-white mb-1">Tell us about yourself</h3>
      <p class="text-gray-400 text-sm mb-6">We'll use this to get back to you quickly</p>

      <div class="space-y-4">
        <div>
          <label for="name" class="block text-sm font-medium text-gray-300 mb-1.5">Full Name *</label>
          <input
            type="text"
            id="name"
            name="name"
            required
            placeholder="John Smith"
            class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-gold-500 focus:ring-1 focus:ring-gold-500 transition-colors"
          />
        </div>
        <div>
          <label for="email" class="block text-sm font-medium text-gray-300 mb-1.5">Email *</label>
          <input
            type="email"
            id="email"
            name="email"
            required
            placeholder="john@example.com"
            class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-gold-500 focus:ring-1 focus:ring-gold-500 transition-colors"
          />
        </div>
        <div>
          <label for="phone" class="block text-sm font-medium text-gray-300 mb-1.5">WhatsApp Number *</label>
          <input
            type="tel"
            id="phone"
            name="phone"
            required
            placeholder="+1 234 567 8900"
            class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-gold-500 focus:ring-1 focus:ring-gold-500 transition-colors"
          />
        </div>
      </div>

      <button type="button" class="btn-primary w-full mt-6 next-step" data-next="2">
        Next Step
        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
      </button>
    </div>

    <!-- Step 2: Trip Details -->
    <div class="form-step hidden" data-step="2">
      <h3 class="text-xl font-bold text-white mb-1">Trip details</h3>
      <p class="text-gray-400 text-sm mb-6">Help us plan the perfect Bali experience</p>

      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label for="arrival" class="block text-sm font-medium text-gray-300 mb-1.5">Arrival Date</label>
            <input
              type="date"
              id="arrival"
              name="arrival_date"
              class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white focus:outline-none focus:border-gold-500 focus:ring-1 focus:ring-gold-500 transition-colors"
            />
          </div>
          <div>
            <label for="departure" class="block text-sm font-medium text-gray-300 mb-1.5">Departure Date</label>
            <input
              type="date"
              id="departure"
              name="departure_date"
              class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white focus:outline-none focus:border-gold-500 focus:ring-1 focus:ring-gold-500 transition-colors"
            />
          </div>
        </div>
        <div>
          <label for="group-size" class="block text-sm font-medium text-gray-300 mb-1.5">Group Size</label>
          <select
            id="group-size"
            name="group_size"
            class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white focus:outline-none focus:border-gold-500 focus:ring-1 focus:ring-gold-500 transition-colors"
          >
            <option value="" class="bg-ocean-950">Select group size</option>
            <option value="1" class="bg-ocean-950">Solo traveler</option>
            <option value="2" class="bg-ocean-950">Couple (2)</option>
            <option value="3-4" class="bg-ocean-950">Small group (3-4)</option>
            <option value="5-8" class="bg-ocean-950">Medium group (5-8)</option>
            <option value="9+" class="bg-ocean-950">Large group (9+)</option>
          </select>
        </div>
        <div>
          <label for="budget" class="block text-sm font-medium text-gray-300 mb-1.5">Daily Budget (per person)</label>
          <select
            id="budget"
            name="budget"
            class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white focus:outline-none focus:border-gold-500 focus:ring-1 focus:ring-gold-500 transition-colors"
          >
            <option value="" class="bg-ocean-950">Select budget range</option>
            <option value="budget" class="bg-ocean-950">Budget ($30-50/day)</option>
            <option value="mid-range" class="bg-ocean-950">Mid-range ($50-100/day)</option>
            <option value="comfort" class="bg-ocean-950">Comfort ($100-200/day)</option>
            <option value="luxury" class="bg-ocean-950">Luxury ($200+/day)</option>
          </select>
        </div>
      </div>

      <div class="flex gap-3 mt-6">
        <button type="button" class="btn-secondary flex-1 prev-step" data-prev="1">Back</button>
        <button type="button" class="btn-primary flex-1 next-step" data-next="3">
          Next Step
          <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
        </button>
      </div>
    </div>

    <!-- Step 3: Activities & Message -->
    <div class="form-step hidden" data-step="3">
      <h3 class="text-xl font-bold text-white mb-1">What interests you?</h3>
      <p class="text-gray-400 text-sm mb-6">Select all activities you'd like to explore</p>

      <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 mb-6">
        {ACTIVITIES.map(activity => (
          <label class="flex items-center gap-2 p-2.5 rounded-lg bg-white/5 border border-white/5 hover:border-gold-500/30 cursor-pointer transition-colors has-[:checked]:border-gold-500/50 has-[:checked]:bg-gold-500/10">
            <input type="checkbox" name="activities" value={activity.shortTitle} class="w-4 h-4 rounded border-white/20 bg-white/5 text-gold-500 focus:ring-gold-500 focus:ring-offset-0" />
            <span class="text-sm text-gray-300">{activity.shortTitle}</span>
          </label>
        ))}
      </div>

      <div>
        <label for="message" class="block text-sm font-medium text-gray-300 mb-1.5">Special Requests / Notes</label>
        <textarea
          id="message"
          name="message"
          rows="3"
          placeholder="Tell us about your dream Bali experience, any special occasions, dietary requirements, accessibility needs..."
          class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-gold-500 focus:ring-1 focus:ring-gold-500 transition-colors resize-none"
        ></textarea>
      </div>

      <div class="flex gap-3 mt-6">
        <button type="button" class="btn-secondary flex-1 prev-step" data-prev="2">Back</button>
        <button type="submit" class="btn-primary flex-1">
          Send Inquiry
          <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
        </button>
      </div>
    </div>

    <!-- Success Message -->
    <div id="form-success" class="hidden text-center py-8">
      <div class="w-16 h-16 bg-palm-500/10 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8 text-palm-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
      </div>
      <h3 class="text-xl font-bold text-white mb-2">Inquiry Sent!</h3>
      <p class="text-gray-400 mb-4">Gede will get back to you within a few hours. For faster response, chat directly on WhatsApp.</p>
    </div>
  </form>
</div>

<script>
  const form = document.getElementById('multi-step-form') as HTMLFormElement;
  const steps = form?.querySelectorAll('.form-step');
  const nextBtns = form?.querySelectorAll('.next-step');
  const prevBtns = form?.querySelectorAll('.prev-step');

  function showStep(stepNum: number) {
    steps?.forEach(step => {
      const s = step as HTMLElement;
      if (parseInt(s.dataset.step || '0') === stepNum) {
        s.classList.remove('hidden');
        s.classList.add('form-step-enter');
      } else {
        s.classList.add('hidden');
        s.classList.remove('form-step-enter');
      }
    });

    // Update indicators
    form?.querySelectorAll('.step-indicator').forEach(indicator => {
      const el = indicator as HTMLElement;
      const step = parseInt(el.dataset.step || '0');
      if (step <= stepNum) {
        el.classList.remove('bg-white/10', 'text-gray-400');
        el.classList.add('bg-gold-500', 'text-ocean-950');
      } else {
        el.classList.remove('bg-gold-500', 'text-ocean-950');
        el.classList.add('bg-white/10', 'text-gray-400');
      }
    });

    // Update progress bars
    form?.querySelectorAll('.step-progress').forEach(bar => {
      const el = bar as HTMLElement;
      const step = parseInt(el.dataset.step || '0');
      el.style.width = step < stepNum ? '100%' : '0%';
    });
  }

  nextBtns?.forEach(btn => {
    btn.addEventListener('click', () => {
      const next = parseInt((btn as HTMLElement).dataset.next || '0');
      showStep(next);
    });
  });

  prevBtns?.forEach(btn => {
    btn.addEventListener('click', () => {
      const prev = parseInt((btn as HTMLElement).dataset.prev || '0');
      showStep(prev);
    });
  });

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(form);

    try {
      const response = await fetch(form.action, {
        method: 'POST',
        body: formData,
      });

      if (response.ok) {
        steps?.forEach(s => (s as HTMLElement).classList.add('hidden'));
        document.getElementById('form-success')?.classList.remove('hidden');
        form.querySelector('.flex.items-center.justify-between')?.classList.add('hidden');
      }
    } catch {
      alert('Something went wrong. Please try WhatsApp instead!');
    }
  });
</script>
