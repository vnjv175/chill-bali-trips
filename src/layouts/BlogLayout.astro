---
import BaseLayout from './BaseLayout.astro';
import { SITE, getWhatsAppLink } from '../utils/siteData';

interface Props {
  title: string;
  description: string;
  pubDate: string;
  updatedDate?: string;
  image?: string;
  category?: string;
  tags?: string[];
  readingTime?: string;
}

const { title, description, pubDate, updatedDate, image, category, tags, readingTime } = Astro.props;

const schema = {
  '@context': 'https://schema.org',
  '@type': 'BlogPosting',
  headline: title,
  description,
  image: image ? new URL(image, SITE.url).href : undefined,
  datePublished: pubDate,
  dateModified: updatedDate || pubDate,
  author: {
    '@type': 'Person',
    name: SITE.operator,
  },
  publisher: {
    '@type': 'Organization',
    name: SITE.name,
    url: SITE.url,
  },
};

const breadcrumbSchema = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: 'Home', item: SITE.url },
    { '@type': 'ListItem', position: 2, name: 'Blog', item: `${SITE.url}/blog/` },
    { '@type': 'ListItem', position: 3, name: title, item: Astro.url.href },
  ],
};
---

<BaseLayout
  title={title}
  description={description}
  image={image}
  type="article"
  schema={schema}
>
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

  <article class="section-padding">
    <div class="container-custom max-w-4xl">
      <!-- Breadcrumbs -->
      <nav class="mb-8 text-sm text-gray-400">
        <a href="/" class="hover:text-gold-400 transition-colors">Home</a>
        <span class="mx-2">/</span>
        <a href="/blog/" class="hover:text-gold-400 transition-colors">Blog</a>
        <span class="mx-2">/</span>
        <span class="text-gray-300">{title}</span>
      </nav>

      <!-- Header -->
      <header class="mb-12">
        {category && (
          <span class="inline-block px-3 py-1 bg-gold-500/10 text-gold-400 text-sm font-medium rounded-full mb-4">
            {category}
          </span>
        )}
        <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-white leading-tight mb-4">
          {title}
        </h1>
        <div class="flex flex-wrap items-center gap-4 text-gray-400 text-sm">
          <time datetime={pubDate}>
            {new Date(pubDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
          </time>
          {readingTime && (
            <>
              <span class="w-1 h-1 bg-gray-600 rounded-full"></span>
              <span>{readingTime}</span>
            </>
          )}
          {updatedDate && (
            <>
              <span class="w-1 h-1 bg-gray-600 rounded-full"></span>
              <span>Updated: {new Date(updatedDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
            </>
          )}
        </div>
      </header>

      <!-- Featured Image -->
      {image && (
        <div class="mb-12 rounded-2xl overflow-hidden">
          <img
            src={image}
            alt={title}
            class="w-full h-[300px] md:h-[450px] object-cover"
            loading="eager"
          />
        </div>
      )}

      <!-- Content -->
      <div class="prose prose-lg prose-invert max-w-none">
        <slot />
      </div>

      <!-- Tags -->
      {tags && tags.length > 0 && (
        <div class="mt-12 pt-8 border-t border-white/10">
          <div class="flex flex-wrap gap-2">
            {tags.map(tag => (
              <span class="px-3 py-1 bg-ocean-900 text-gray-300 text-sm rounded-full border border-white/5">
                {tag}
              </span>
            ))}
          </div>
        </div>
      )}

      <!-- CTA Box -->
      <div class="mt-12 p-8 bg-gradient-to-br from-gold-500/10 to-sunset-500/10 rounded-2xl border border-gold-500/20">
        <h3 class="text-xl font-bold text-white mb-2">Let Chill Bali Trips Plan This For You</h3>
        <p class="text-gray-300 mb-6">
          Want to experience the best of Bali without the planning hassle? Gede will build your perfect itinerary, handle all bookings, and make sure every moment is unforgettable.
        </p>
        <div class="flex flex-wrap gap-4">
          <a href="/contact/" class="btn-primary">Get a Free Quote</a>
          <a href={getWhatsAppLink()} class="btn-whatsapp" target="_blank" rel="noopener noreferrer">
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
            Chat on WhatsApp
          </a>
        </div>
      </div>
    </div>
  </article>
</BaseLayout>
